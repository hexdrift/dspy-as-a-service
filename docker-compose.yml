# Simple single-container deployment
# No Redis, no Celery - just the API with background workers

version: "3.8"

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: dspy-service
    ports:
      - "8000:8000"
    environment:
      # Worker configuration
      - WORKER_CONCURRENCY=2
      - WORKER_POLL_INTERVAL=2.0
      - LOCAL_DB_PATH=/app/data/dspy_jobs.db
      # Remote PostgreSQL backend (set JOB_STORE_BACKEND=remote to use)
      # - REMOTE_DB_URL=postgresql://user:pass@host:5432/dbname
      # Logging
      - LOG_LEVEL=INFO
    volumes:  # [WORKER-FIX] persist SQLite DB across container restarts
      - dspy-data:/app/data
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 4G

volumes:
  dspy-data:

networks:
  default:
    driver: bridge
